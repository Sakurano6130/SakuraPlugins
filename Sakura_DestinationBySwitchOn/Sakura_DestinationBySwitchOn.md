# Sakura_DestinationBySwitchOn
### スイッチオンで次の目的表示

![alt text](image-41.png)


### 子目的も表示できる `ver.2.0`

![alt text](image-19.png)

### アーカイブシーン（過去の目的一覧）を表示できる。アーカイブシーンにはテキストだけでなくピクチャ表示もできる。 `ver.2.0`

![alt text](image-18.png)

### アーカイブシーンから、マップ上に表示する目的を選択できる `ver.2.0`

![alt text](image-56.png)

### おまけ）ゲーム内で撮ったスクリーンショットをアーカイブシーンのピクチャ画像にできる `ver.2.0`

![alt text](image-40.png)

## ダウンロード
[Sakura_DestinationBySwitchOn.js](https://raw.githubusercontent.com/Sakurano6130/SakuraPlugins/main/Sakura_DestinationBySwitchOn/Sakura_DestinationBySwitchOn.js)


## 更新履歴
| ver   | 日付       | 説明                                                                                                 |
| ----- | ---------- | ---------------------------------------------------------------------------------------------------- |
| 2.0.0 | 2024/09/17 | 子目的表示の追加<br>アーカイブシーンの追加                                                           |
| 1.0.3 | 2024/09/09 | ツクールのシステム設定で、画面の幅・高さとUIエリアの幅・高さが異なる設定をしている場合の位置を調整。 |
| 1.0.2 | 2024/09/04 | ファイル出力判定ミス修正                                                                             |
| 1.0.1 | 2024/09/03 | 初期表示時に後ろのウィンドウを隠さないように修正                                                     |
| 1.0.0 | 2024/09/03 | 公開                                                                                                 |


## 機能説明

### スイッチの名前が`$`で始まるものが`オン`になったとき、そのスイッチの名前を自動的に次の目的として表示します。
  ![alt text](image-1.png)

### スイッチの名前が `@親=親のスイッチ` で始まるものをスイッチに登録しておくと、そのスイッチが自動的に子目的になって表示されます。`ver.2.0`
  
  ![alt text](image-8.png)

  ![alt text](image-20.png)

  ![alt text](image-9.png)

  子目的のスイッチがオンになると、自動でチェックがついて進捗が上がります。

  ![alt text](image-10.png)


###  ここまでの機能でよければ、ここまでで大丈夫です。以下は、アーカイブシーンを表示する機能の説明です。（ちょっと複雑です...）

---

### **コモンイベント** で プラグインコマンド **「ｱｰｶｲﾌﾞ登録」** をしておくと、アーカイブシーンで過去の目的の一覧を表示することができます。`ver.2.0`

![alt text](image-40.png)
  
  - ゲーム起動時に自動的にコモンイベントの中を検索して読み込むので、このコモンイベントは実行する必要ありません。トリガーは「なし」でよいです。
  - どのコモンイベントのどこにおいても大丈夫ですが、アーカイブシーンで表示される順番はコモンイベントに置いた順になります。
  - １つのコモンイベントの中に全部を書いても良いし、別々のコモンイベントに分けて書いても良いです。

    ![alt text](image-46.png)

  - プラグインコマンド **「ｱｰｶｲﾌﾞ登録」** で、カテゴリ、タイトル、スイッチ、ピクチャ、詳細を設定してください。

    ![alt text](image-47.png)

  - カテゴリ設定です。このカテゴリごとにアーカイブシーンで折り畳み表示されます。

    ![alt text](image-48.png)


  - タイトルを設定してください。

    ![alt text](image-49.png)

  - 紐づけるスイッチを指定してください。指定するとオンの時のみ表示されるようになります。指定しない場合は、常に表示されます。ここではスイッチ名に$がついていないものも指定できます。

    ![alt text](image-15.png)

  - 表示したいピクチャを指定してください。

    ![alt text](image-16.png)

  - 詳細文章を記載してください。横は自動でウィンドウ幅に合わせて改行されます。縦に長い場合はスクロールします。縦の長さの限界は、プラグインパラメータの「detailWindowMaxContentsHeight」で設定できます。（デフォルト10000px）

    ![alt text](image-17.png)

    上記の通り設定しておくと、以下のようになります。

    ![alt text](image-21.png)

---

## アーカイブシーンを呼び出す方法 `ver.2.0`

2つ方法があります。
### ①プラグインコマンドから呼び出す
### ②プラグインパラメータでメニューコマンドに登録する

---

### ①プラグインコマンドから呼び出す

  - プラグインコマンドの「アーカイブシーンの呼び出し」で呼び出せます。
  - このとき、シーンの左上に大きく出るタイトルと、表示する対象のカテゴリ（前方一致検索・複数指定可）を設定できます。
  - カテゴリを指定しなかった場合は、コモンイベントに登録した全ての目的が対象となります。
  - 注）目的にスイッチが紐づけられている場合は、そのスイッチがオンにならないと表示されません。

    ![alt text](image-50.png)

    ![alt text](image-51.png)

    ![alt text](image-52.png)

- イメージはこんな感じです。

    ![alt text](image-53.png)

### ②プラグインパラメータでメニューコマンドに登録する

  - デフォルトのメニュー画面にコマンドを追加することができます。(並び替えとオプションの間)
    ![alt text](image-43.png)


  - プラグインパラメータ設定画面の「ﾒﾆｭｰｺﾏﾝﾄﾞ設定」から設定できます。

    ![alt text](image-54.png)

  - 指定したカテゴリごとに独立した別のコマンドとして複数設定することもできます。なので、チュートリアルのようなカテゴリだけのアーカイブシーンや、登場人物紹介、書物内容といったアーカイブシーンを作ることもできます。

    ![alt text](image-55.png)

  - コマンド名、対象のカテゴリ（前方一致検索・複数指定可）を指定してください。
  - カテゴリを指定しなかった場合は、コモンイベントに登録した全ての目的が対象となります。
  - 注）目的にスイッチが紐づけられている場合は、そのスイッチがオンにならないと表示されません。

    ![alt text](image-30.png)

    ![alt text](image-31.png)

    ![alt text](image-32.png)

  - 有効/無効を制御するスイッチID：このスイッチがオンになっていない場合は、コマンドが非活性になりメニューから呼び出すことができません。ストーリーが進むと解放されるメニューコマンドのような演出にご利用ください。

    ![alt text](image-33.png)

## プラグインパラメータ
### 📍 ﾏｯﾌﾟ上の目的表示の設定

- **destinationPosition**
  - 目的を表示する位置です。左上、右上、左下、右下から選べます。

- **destinationTextX**
  - 目的を表示する位置のX軸補正です。

- **destinationTextY**
  - 目的を表示する位置のY軸補正です。

- **destinationFontSize**
  - 目的を表示するフォントサイズです。

- **destinationFontColor** `ver.2.0`
  - 目的のﾌｫﾝﾄ色です。

- **destinationFontColorIfHasChildren** `ver.2.0`
  - 目的のﾌｫﾝﾄ色(子目的がある場合)です。

- **categoryFontSize** `ver.2.0`
  - 目的の上に出るｶﾃｺﾞﾘのﾌｫﾝﾄｻｲｽﾞです。

- **categoryFontColor** `ver.2.0`
  - 目的の上に出るｶﾃｺﾞﾘのﾌｫﾝﾄ色です。

- **childrenFontSize** `ver.2.0`
  - 子目的のﾌｫﾝﾄｻｲｽﾞです。

- **childrenFontColor** `ver.2.0`
  - 子目的のﾌｫﾝﾄ色です。

- **childrenFontColorIfCompleted** `ver.2.0`
  - 子目的のﾌｫﾝﾄ色(達成している場合)です。

- **storyProgressText**
  - 目的が変わった時に差し込む言葉です。指定しなかった場合は表示されません。
   
  ![alt text](image-6.png)

- **storyProgressTextColor**
  - 目的が変わった時に差し込む言葉の色です。

- **storyProgressTextDuration** `ver.2.0`
  - ｽﾄｰﾘｰが進行したときに表示するﾃｷｽﾄの時間です。

---

### ⚙️ アーカイブシーンの設定 `ver.2.0`

- **paddingInSceneDestination** `ver.2.0`
  - シーン全体の画面との余白です。

- **listWindowWidthRate** `ver.2.0`
  - 左側のｶﾃｺﾞﾘｳｨﾝﾄﾞｳ幅の画面に対する大きさ（％）です。

- **listWindowItemHeight** `ver.2.0`
  - 左側のｶﾃｺﾞﾘｳｨﾝﾄﾞｳの１行の高さです。

- **listWindowFontSize** `ver.2.0`
  - 左側のｶﾃｺﾞﾘｳｨﾝﾄﾞｳのﾌｫﾝﾄｻｲｽﾞです。

- **detailWindowTitleFontSize** `ver.2.0`
  - 右側の詳細ｳｨﾝﾄﾞｳのﾀｲﾄﾙのﾌｫﾝﾄｻｲｽﾞです。

- **detailWindowPadding** `ver.2.0`
  - 右側の詳細ｳｨﾝﾄﾞｳの内側の余白です。

- **detailWindowPictureWidth** `ver.2.0`
  - 右側の詳細ｳｨﾝﾄﾞｳのピクチャの幅です。

- **detailWindowPictureHeight** `ver.2.0`
  - 右側の詳細ｳｨﾝﾄﾞｳのピクチャの高さです。

- **detailWindowMaxContentsHeight** `ver.2.0`
  - 右側の詳細ｳｨﾝﾄﾞｳの文章の最大高さ(px)（高くするほど長い文章を表示できますが重くなります）

- **commandWindowTextSetPriority** `ver.2.0`
  - 「この目的を優先表示する」の言葉を変更します

- **commandWindowTextAlreadyCompleted** `ver.2.0`
  - 「この目的は達成済みです」の言葉を変更します

---
### ➕ ﾒﾆｭｰｺﾏﾝﾄﾞへの追加 `ver.2.0`

  上記、アーカイブシーンを呼び出す方法 > ②プラグインパラメータでメニューコマンドに登録する を参照ください。

---
- **needsOutputDestinations**
  - 目的をファイルに書き込むかどうか。これをtrueにして、テストプレイを実行するとプロジェクトフォルダ直下に「destinationsBySwitch.txt」というファイルが出力されます。
  - スイッチの親子関係を表にしたテキストファイルを出力します。`ver.2.0`
  
  ![alt text](image-3.png)

  ![alt text](image-34.png)


## プラグインコマンドの使用

プラグインコマンドから、以下を使用できます。

- マップ上の目的ウィンドウを隠す
  
  ![alt text](image-35.png)

- マップ上の目的ウィンドウを表示する
  
  ![alt text](image-36.png)

- 目的を達成状態にする

  目的を達成状態にすることで、アーカイブシーンで「優先表示」を選択できないようにします。

  ![alt text](image-37.png)


### おまけ）スクリーンショット機能

- ゲーム内のスクリーンショットを撮って、目的表示画面のピクチャに設定することができます。
- このコマンドを実行すると、指定したスイッチのアーカイブシーンに表示されるピクチャが、元々設定していたピクチャではなく、スクリーンショットの方になります。
- なぜおまけかというと、その分セーブデータの容量が大きくなってしまうためです。セーブデータの容量が大きくなっても問題ない作品のみでご使用ください。

  ![alt text](image-39.png)

サイズ感

- file5: 普通のセーブデータ
- file6: 400×200で圧縮率0.7で1枚ｽｸﾘｰﾝｼｮｯﾄを撮ってセーブしたセーブデータ

  ![alt text](image-57.png)

# License
- This software is released under the MIT license. http://opensource.org/licenses/mit-license.php
